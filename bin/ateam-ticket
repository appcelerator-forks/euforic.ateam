#!/usr/bin/env node

/**
 * Module dependencies.
 */

// inject shelljs to the global scope

require('shelljs/global');

var program = require('commander')
  , ticket = require('../lib/tickets')
  , AVAIL_CMDS = Object.keys(ticket);

// usage

program.usage('<number> <command>');

// examples

program.on('--help', function(){
  console.log('  view    view ticket on jira');
  console.log('  fix     creates a new git branch for the ticket');
  console.log('  pullreq submit pull request to upstream branch');
  console.log('  close   rm ticket git branches and open ticket in jira');
  console.log('  review  create a new git branch to review ticket');
  console.log();
  process.exit();
});

// parse argv

program.parse(process.argv);

// package

var tnumber = program.args.shift();

// props

var task = program.args.shift();

// check if command is valid

if ( AVAIL_CMDS.indexOf(task) < 0 ) {
  exec('ateam ticket --help');
  process.exit();
}

// dynamical call requested ticket function

ticket[cmd]( tnumber );